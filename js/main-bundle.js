!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){!function(){function a(a){return"function"==typeof a?a:function(){return a}}function c(a){return a[0]}function d(a){return a[1]}function e(a){return a.x}function f(a){return a.y}function g(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function h(a,b,c,d,e,f){if(!a(b,c,d,e,f)){var g=.5*(c+e),i=.5*(d+f),j=b.nodes;j[0]&&h(a,j[0],c,d,g,i),j[1]&&h(a,j[1],g,d,e,i),j[2]&&h(a,j[2],c,i,g,f),j[3]&&h(a,j[3],g,i,e,f)}}var i=Math.abs,j=function(b,j,k,l,m){function n(b){function c(a,b,c,e,f,g,h,j){if(!isNaN(c)&&!isNaN(e))if(a.leaf){var k=a.x,l=a.y;if(null!=k)if(i(k-c)+i(l-e)<.01)d(a,b,c,e,f,g,h,j);else{var m=a.point;a.x=a.y=a.point=null,d(a,m,k,l,f,g,h,j),d(a,b,c,e,f,g,h,j)}else a.x=c,a.y=e,a.point=b}else d(a,b,c,e,f,g,h,j)}function d(a,b,d,e,f,h,i,j){var k=.5*(f+i),l=.5*(h+j),m=d>=k,n=e>=l,o=(n<<1)+m;a.leaf=!1,a=a.nodes[o]||(a.nodes[o]=g()),m?f=k:i=k,n?h=l:j=l,c(a,b,d,e,f,h,i,j)}var e,f,n,r,s,t,u,v,w,x=a(p),y=a(q);if(null!=j)t=j,u=k,v=l,w=m;else if(v=w=-(t=u=1/0),f=[],n=[],s=b.length,o)for(r=0;s>r;++r)e=b[r],e.x<t&&(t=e.x),e.y<u&&(u=e.y),e.x>v&&(v=e.x),e.y>w&&(w=e.y),f.push(e.x),n.push(e.y);else for(r=0;s>r;++r){var z=+x(e=b[r],r),A=+y(e,r);t>z&&(t=z),u>A&&(u=A),z>v&&(v=z),A>w&&(w=A),f.push(z),n.push(A)}var B=v-t,C=w-u;B>C?w=u+B:v=t+C;var D=g();if(D.add=function(a){c(D,a,+x(a,++r),+y(a,r),t,u,v,w)},D.visit=function(a){h(a,D,t,u,v,w)},r=-1,null==j){for(;++r<s;)c(D,b[r],f[r],n[r],t,u,v,w);--r}else b.forEach(D.add);return f=n=b=e=null,D}var o,p=c,q=d;return(o=arguments.length)?(p=e,q=f,3===o&&(m=k,l=j,k=j=0),n(b)):(n.x=function(a){return arguments.length?(p=a,n):p},n.y=function(a){return arguments.length?(q=a,n):q},n.extent=function(a){return arguments.length?(null==a?j=k=l=m=null:(j=+a[0][0],k=+a[0][1],l=+a[1][0],m=+a[1][1]),n):null==j?null:[[j,k],[l,m]]},n.size=function(a){return arguments.length?(null==a?j=k=l=m=null:(j=k=0,l=+a[0],m=+a[1]),n):null==j?null:[l-j,m-k]},n)};b.exports=j}()},{}],2:[function(a,b){var c=function(){"use strict";"use restrict";function a(a,b,c){this.flags=a,this.callback=b,this.context=c}var b={},e={},f=-1,g=[];return a.prototype.dispatch=function(a,b){this.flags===a&&(this.context?this.callback.call(this.context,b):this.callback(b))},b.LOGS=1,b.WARNINGS=2,b.ERRORS=4,b.logFlags=b.ERRORS,b.currentContext={},b.registerContext=function(a){e[a.id]=a,b.enableContext(a)},b.getContextById=function(a){return e[a]?e[a]:(c.error("Couldn't find context id "+a+", returning current with id "+b.currentContext.id),b.currentContext)},b.enableContext=function(a){b.currentContext="string"==typeof a?getContextById(a):a,d=b.GL=b.currentContext.GL},b.uniqueId=function(){return++f},b.log=function(a){b.logFlags&b.LOGS&&console.log(a),b.dispatch(b.LOGS,a)},b.warn=function(a){b.logFlags&b.WARNINGS&&console.warn(a),b.dispatch(b.WARNINGS,a)},b.error=function(a){b.logFlags&b.ERRORS&&console.error(a),b.dispatch(b.ERRORS,a)},b.addEventListener=function(b,c,d){return g.push(new a(b,c,d)),g[g.length-1]},b.removeEventListener=function(a){var c=g.indexOf(a);return-1!==c?(g.splice(c,1),void 0):(b.warn("GLOW.removeEventListener: Couldn't find listener object"),void 0)},b.dispatch=function(a,b){for(var c=g.length;c--;)g[c].dispatch(a,b)},b}(),d={};c.Context=function(){"use strict";"use restrict";function a(a){if(void 0===a&&(a={}),this.id=void 0!==a.id?a.id:c.uniqueId(),this.alpha=void 0!==a.alpha?a.alpha:!0,this.depth=void 0!==a.depth?a.depth:!0,this.antialias=void 0!==a.antialias?a.antialias:!0,this.stencil=void 0!==a.stencil?a.stencil:!1,this.premultipliedAlpha=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,this.preserveDrawingBuffer=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!1,this.width=void 0!==a.width?a.width:window.innerWidth,this.height=void 0!==a.height?a.height:window.innerHeight,this.cache=new c.Cache,this.debug=void 0!==a.debug?a.debug:!1,a.context)this.GL=a.context,c.registerContext(this);else{try{this.domElement=document.createElement("canvas"),this.debug&&window.WebGLDebugUtils&&(this.domElement=WebGLDebugUtils.makeLostContextSimulatingCanvas(this.domElement)),this.GL=this.domElement.getContext("experimental-webgl",{alpha:this.alpha,depth:this.depth,antialias:this.antialias,stencil:this.stencil,premultipliedAlpha:this.premultipliedAlpha,preserveDrawingBuffer:this.preserveDrawingBuffer})}catch(b){c.error("GLOW.Context.construct: "+b)}null!==this.GL?(c.registerContext(this),this.domElement.width=this.width,this.domElement.height=this.height,this.viewport=a.viewport?{x:void 0!==a.viewport.x?a.viewport.x:0,y:void 0!==a.viewport.y?a.viewport.y:0,width:void 0!==a.viewport.width?a.viewport.width:this.width,height:void 0!==a.viewport.height?a.viewport.height:this.height}:{x:0,y:0,width:this.width,height:this.height},a.clear?(this.clearSettings={r:void 0!==a.clear.red?a.clear.red:0,g:void 0!==a.clear.green?a.clear.green:0,b:void 0!==a.clear.blue?a.clear.blue:0,a:void 0!==a.clear.alpha?a.clear.alpha:1,depth:void 0!==a.clear.depth?a.clear.depth:1,bits:void 0!==a.clear.bits?a.clear.bits:-1},-1===this.clearSettings.bits&&(this.clearSettings.bits=d.COLOR_BUFFER_BIT,this.clearSettings.bits|=this.depth?d.DEPTH_BUFFER_BIT:0,this.clearSettings.bits|=this.stencil?d.STENCIL_BUFFER_BIT:0)):(this.clearSettings={r:0,g:0,b:0,a:1,depth:1,bits:0},this.clearSettings.bits=d.COLOR_BUFFER_BIT,this.clearSettings.bits|=this.depth?d.DEPTH_BUFFER_BIT:0,this.clearSettings.bits|=this.stencil?d.STENCIL_BUFFER_BIT:0),this.enableCulling(!0,{frontFace:d.CCW,cullFace:d.BACK}),this.enableDepthTest(!0,{func:d.LEQUAL,write:!0,zNear:0,zFar:1}),this.enableBlend(!1),this.setViewport(),this.clear()):c.error("GLOW.Context.construct: unable to initialize WebGL")}}return a.prototype.setupClear=function(a){return void 0!==a&&(this.clearSettings.r=void 0!==a.red?Math.min(1,Math.max(0,a.red)):this.clearSettings.r,this.clearSettings.g=void 0!==a.green?Math.min(1,Math.max(0,a.green)):this.clearSettings.g,this.clearSettings.b=void 0!==a.blue?Math.min(1,Math.max(0,a.blue)):this.clearSettings.b,this.clearSettings.a=void 0!==a.alpha?Math.min(1,Math.max(0,a.alpha)):this.clearSettings.a,this.clearSettings.depth=void 0!==a.depth?Math.min(1,Math.max(0,a.depth)):this.clearSettings.depth,this.clearSettings.bits=void 0!==a.bits?a.bits:this.clearSettings.bits),d.clearColor(this.clearSettings.r,this.clearSettings.g,this.clearSettings.b,this.clearSettings.a),d.clearDepth(this.clearSettings.depth),this},a.prototype.clear=function(a){return this.setupClear(a),d.clear(this.clearSettings.bits),this},a.prototype.enableBlend=function(a,b){return a?(d.enable(d.BLEND),b&&this.setupBlend(b)):d.disable(d.BLEND),this},a.prototype.setupBlend=function(a){return a.equationRGB?(a.equationAlpha&&d.blendEquationSeparate(a.equationRGB,a.equationAlpha),a.srcRGB&&d.blendFuncSeparate(a.srcRGB,a.dstRGB,a.srcAlpha,a.dstAlpha)):(a.equation&&d.blendEquation(a.equation),a.src&&d.blendFunc(a.src,a.dst)),this},a.prototype.enableDepthTest=function(a,b){return a?(d.enable(d.DEPTH_TEST),b&&this.setupDepthTest(b)):d.disable(d.DEPTH_TEST),this},a.prototype.setupDepthTest=function(a){return void 0!==a.func&&d.depthFunc(a.func),void 0!==a.write&&d.depthMask(a.write),void 0!==a.zNear&&void 0!==a.zFar&&a.zNear<=a.zFar&&d.depthRange(Math.max(0,Math.min(1,a.zNear)),Math.max(0,Math.min(1,a.zFar))),this},a.prototype.enablePolygonOffset=function(a,b){return a?(d.enable(d.POLYGON_OFFSET_FILL),b&&this.setupPolygonOffset(b)):d.disable(d.POLYGON_OFFSET_FILL),this},a.prototype.setupPolygonOffset=function(a){a.factor&&a.units&&d.polygonOffset(a.factor,a.units)},a.prototype.enableStencilTest=function(a,b){return a?(d.enable(d.STENCIL_TEST),b&&this.setupStencilTest(b)):d.disable(d.STENCIL_TEST),this},a.prototype.setupStencilTest=function(a){return a.func&&a.funcFace?d.stencilFuncSeparate(a.funcFace,a.func,a.funcRef,a.funcMask):a.func&&d.stencilFunc(a.func,a.funcRef,a.funcMask),a.mask&&a.maskFace?d.stencilMaskSeparate(a.maskFace,a.mask):a.mask&&d.stencilMask(a.mask),a.opFail&&a.opFace?d.stencilOpSeparate(a.opFace,a.opFail,a.opZfail,a.opZpass):a.opFail&&d.stencilOp(a.opFail,a.opZfail,a.opZpass),this},a.prototype.enableCulling=function(a,b){return a?(d.enable(d.CULL_FACE),b&&this.setupCulling(b)):d.disable(d.CULL_FACE),this},a.prototype.setupCulling=function(a){try{a.frontFace&&d.frontFace(a.frontFace),a.cullFace&&d.cullFace(a.cullFace)}catch(b){c.error("GLOW.Context.setupCulling: "+b)}return this},a.prototype.enableScissor=function(a,b){return a?(d.enable(d.SCISSOR_TEST),b&&this.setupScissor(b)):d.disable(d.SCISSOR_TEST),this},a.prototype.setupScissor=function(a){try{d.scissor(a.x,a.y,a.width,a.height)}catch(b){c.error("GLOW.Context.setupScissorTest: "+b)}return this},a.prototype.setViewport=function(){this.setupViewport()},a.prototype.setupViewport=function(a){return a&&(this.viewport.x=void 0!==a.x?a.x:this.viewport.x,this.viewport.y=void 0!==a.y?a.y:this.viewport.y,this.viewport.width=void 0!==a.width?a.width:this.viewport.width,this.viewport.height=void 0!==a.height?a.height:this.viewport.height),d.viewport(this.viewport.x,this.viewport.y,this.viewport.width,this.viewport.height),this},a.prototype.availableExtensions=function(){return d.getSupportedExtensions()},a.prototype.enableExtension=function(a){for(var b=d.getSupportedExtensions(),c=0,e=b.length;e>c&&a.toLowerCase()!==b[c].toLowerCase();c++);return c!==e?d.getExtension(b[c]):void 0},a.prototype.getParameter=function(a){return d.getParameter(a)},a.prototype.maxVertexTextureImageUnits=function(){return this.getParameter(d.MAX_VERTEX_TEXTURE_IMAGE_UNITS)},a.prototype.resize=function(a,b){var c=a/this.width,d=b/this.height;this.viewport.width=this.viewport.width*c,this.viewport.height=this.viewport.height*d,this.domElement.width=this.width=a,this.domElement.height=this.height=b},a}(),c.Compiler=function(){"use strict";"use restrict";var a={};return a.compile=function(b){var e=c.currentContext.cache.codeCompiled(b.vertexShader,b.fragmentShader);void 0===e&&(e=a.linkProgram(a.compileVertexShader(b.vertexShader),a.compileFragmentShader(b.fragmentShader)),c.currentContext.cache.addCompiledProgram(e));var f=a.createUniforms(a.extractUniforms(e),b.data),g=a.createAttributes(a.extractAttributes(e),b.data,b.usage,b.interleave),h=a.interleaveAttributes(g,b.interleave);if(b.elements)return c.error("GLOW.Compiler.compile: .elements is no longer supported, please use .indices combined with .primitives"),void 0;var i=b.indices,j=void 0!==b.primitives?b.primitives:d.TRIANGLES,k=void 0!==b.usage?b.usage:{},l=k.primitives;if(b.triangles?(i=b.triangles,l=k.triangles):b.triangleStrip?(i=b.triangleStrip,j=d.TRIANGLE_STRIP,l=k.triangleStrip):b.triangleFan?(i=b.triangleFan,j=d.TRIANGLE_FAN,l=k.triangleFan):b.points?(i=b.points,j=d.POINTS,l=k.points):b.lines?(i=b.lines,j=d.LINES,l=k.lines):b.lineLoop?(i=b.lineLoop,j=d.LINE_LOOP,l=k.lineLoop):b.lineStrip&&(i=b.lineStrip,j=d.LINE_STRIP,l=k.lineStrip),void 0===i){for(var m in g)if(g[m].data){i=g[m].data.length/g[m].size;break}if(void 0===i)for(var n in h){for(var m in h[n].attributes){i=h[n].attributes[m].data.length/h[n].attributes[m].size;break}break}void 0===i&&(i=0)}var o=a.createElements(i,j,l);return new c.CompiledData(e,f,g,h,o,b)},a.compileVertexShader=function(a){var b;return b=d.createShader(d.VERTEX_SHADER),b.id=c.uniqueId(),d.shaderSource(b,a),d.compileShader(b),d.getShaderParameter(b,d.COMPILE_STATUS)||d.isContextLost()||c.error("GLOW.Compiler.compileVertexShader: "+d.getShaderInfoLog(b)),b},a.compileFragmentShader=function(a){var b;return b=d.createShader(d.FRAGMENT_SHADER),b.id=c.uniqueId(),d.shaderSource(b,a),d.compileShader(b),d.getShaderParameter(b,d.COMPILE_STATUS)||d.isContextLost()||c.error("GLOW.Compiler.compileFragmentShader: "+d.getShaderInfoLog(b)),b},a.linkProgram=function(a,b){var e=d.createProgram();return e||c.error("GLOW.Compiler.linkProgram: Could not create program"),e.id=c.uniqueId(),d.attachShader(e,a),d.attachShader(e,b),d.linkProgram(e),d.getProgramParameter(e,d.LINK_STATUS)||d.isContextLost()||c.error("GLOW.Compiler.linkProgram: Could not initialise program"),e},a.extractUniforms=function(a){for(var b,c,e={},f=0,g=d.getProgramParameter(a,d.ACTIVE_UNIFORMS);g>f&&(c=d.getActiveUniform(a,f),null!==c&&-1!==c&&void 0!==c);f++)b={name:c.name.split("[")[0],size:c.size,type:c.type,location:d.getUniformLocation(a,c.name.split("[")[0]),locationNumber:f},e[b.name]=b;return e},a.extractAttributes=function(a){for(var b,c,e={},f=0,g=d.getProgramParameter(a,d.ACTIVE_ATTRIBUTES);g>f&&(c=d.getActiveAttrib(a,f),null!==c&&-1!==c&&void 0!==c);f++)b={name:c.name,size:c.size,type:c.type,location:d.getAttribLocation(a,c.name),locationNumber:f},e[b.name]=b;return a.highestAttributeNumber=f-1,e},a.createUniforms=function(a,b){var e,f,g,h={},i=0;for(e in a)f=a[e],g=f.name,b[g]instanceof c.Uniform?h[g]=b[g]:(void 0===b[g]&&c.warn("GLOW.Compiler.createUniforms: missing data for uniform "+g+". Creating anyway, but make sure to set data before drawing."),h[g]=new c.Uniform(f,b[g]),(h[g].type===d.SAMPLER_2D||h[g].type===d.SAMPLER_CUBE)&&(h[g].textureUnit=i++,void 0!==h[g].data&&h[g].data.init()));return h},a.createAttributes=function(a,b,d,e){var f,g,h,i={},j=!0;e=void 0!==e?e:{},e===!1&&(j=!1),d=void 0!==d?d:{};for(f in a)g=a[f],h=g.name,b[h]instanceof c.Attribute?i[h]=b[h]:(void 0===b[h]&&c.warn("GLOW.Compiler.createAttributes: missing data for attribute "+h+". Creating anyway, but make sure to set data before drawing."),i[h]=new c.Attribute(g,b[h],d[h],void 0!==e[h]?e[h]:j));return i},a.interleaveAttributes=function(a,b){if(b=void 0!==b?b:{},b===!1)return{};var d,e,f,g,h,i=0,j=[];e=0;for(d in a)e++;if(1===e){for(d in a)a[d].interleaved===!0&&(a[d].interleaved=!1,a[d].data&&a[d].bufferData());return void 0}for(d in a)void 0!==b[d]&&b[d]!==!1&&(i=Math.max(i-1,b[d])+1);for(d in a)void 0===b[d]&&(b[d]=i);for(h in b)b[h]!==!1&&(void 0===j[b[h]]&&(j[b[h]]=[]),j[b[h]].push(a[h]));var k,l;for(d=0,e=j.length;e>d;d++)if(void 0!==j[d])for(k=0,f=0,g=j[d].length;g>f;f++)if(k+4*j[d][f].size>255)for(c.warn("GLOW.Compiler.interleaveAttributes: Stride owerflow, moving attributes to new interleave index. Please check your interleave setup!"),l=j.length,j[l]=[];g>f;)j[l].push(j[d][f]),j[d].splice(f,1),g--;else k+=4*j[d][f].size;var m,n={};for(d=0,e=j.length;e>d;d++)if(void 0!==j[d]){for(m="",f=0,g=j[d].length;g>f;f++)m+=f!==g-1?j[d][f].name+"_":j[d][f].name;n[m]=new c.InterleavedAttributes(j[d])}for(h in b)b[h]!==!1&&delete a[h];return n},a.createElements=function(a,b,d){var e;return e=a instanceof c.Elements?a:new c.Elements(a,b,d)},a}(),c.CompiledData=function(){"use strict";"use restrict";function a(a,b,d,e,f){this.id=c.uniqueId(),this.program=a,this.uniforms=b||{},this.attributes=d||{},this.interleavedAttributes=e||{},this.elements=f,this.uniformArray=void 0,this.attributeArray=void 0,this.interleavedAttributeArray=void 0,this.createArrays()}return a.prototype.createArrays=function(){this.uniformArray=[],this.attributeArray=[],this.interleavedAttributeArray=[];var a,b,c;for(a in this.uniforms)this.uniformArray.push(this.uniforms[a]);for(b in this.attributes)this.attributeArray.push(this.attributes[b]);for(c in this.interleavedAttributes)this.interleavedAttributeArray.push(this.interleavedAttributes[c])},a.prototype.clone=function(a){var b=new c.CompiledData;a=a||{};var e;for(e in this.uniforms)a[e]?a[e]instanceof c.Uniform?b.uniforms[e]=a[e]:(b.uniforms[e]=new c.Uniform(this.uniforms[e],a[e]),(b.uniforms[e].type===d.SAMPLER_2D||b.uniforms[e].type===d.SAMPLER_CUBE)&&(b.uniforms[e].textureUnit=this.uniforms[e].textureUnit,b.uniforms[e].data&&b.uniforms[e].data.init())):b.uniforms[e]=this.uniforms[e];var f;for(f in this.attributes)b.attributes[f]=a[f]?a[f]instanceof c.Attribute?a[f]:new c.Attribute(this.attributes[f],a[f]):this.attributes[f];var g;for(g in this.interleavedAttributes)b.interleavedAttributes[g]=a[g]?a[g]:this.interleavedAttributes[g];return b.elements=a.indices?new c.Elements(a.indices,a.primitives):a.elements instanceof c.Elements?a.elements:this.elements,b.program=a.program?a.program:this.program,b.createArrays(),b},a.prototype.dispose=function(a,b,c){if(a){var e,f,g;for(e=this.uniformArray.length;e--;)this.uniformArray[e].dispose(c);for(f=this.attributeArray.length;f--;)this.attributeArray[f].dispose();for(g=this.interleavedAttributeArray.length;g--;)this.interleavedAttributeArray[g].dispose();this.elements.dispose()}if(b&&d.isProgram(this.program)){var h=d.getAttachedShaders(this.program);if(h){for(var i=h.length;i--;)d.detachShader(this.program,h[i]),d.deleteShader(h[i]);d.deleteProgram(this.program)}}delete this.program,delete this.uniforms,delete this.attributes,delete this.interleavedAttributes,delete this.elements,delete this.uniformArray,delete this.attributeArray,delete this.interleavedAttributeArray},a}(),c.Cache=function(){"use strict";"use restrict";function a(){this.highestAttributeNumber=-1,this.uniformByLocation=[],this.attributeByLocation=[],this.textureByLocation=[],this.compiledCode=[],this.elementId=-1,this.programId=-1,this.active=!0}return a.prototype.codeCompiled=function(a,b){var c,d,e=this.compiledCode.length;for(d=0;e>d&&(c=this.compiledCode[d],a!==c.vertexShader||b!==c.fragmentShader);d++);return d===e?(this.compiledCode.push({vertexShader:a,fragmentShader:b}),void 0):this.compiledCode[d].program},a.prototype.addCompiledProgram=function(a){this.compiledCode[this.compiledCode.length-1].program=a},a.prototype.programCached=function(a){if(this.active){if(a.id===this.programId)return!0;this.programId=a.id,this.uniformByLocation.length=0,this.attributeByLocation.length=0,this.textureByLocation.length=0,this.elementId=-1}return!1},a.prototype.setProgramHighestAttributeNumber=function(a){var b=this.highestAttributeNumber;return this.highestAttributeNumber=a.highestAttributeNumber,a.highestAttributeNumber-b},a.prototype.uniformCached=function(a){if(this.active){if(this.uniformByLocation[a.locationNumber]===a.id)return!0;this.uniformByLocation[a.locationNumber]=a.id}return!1},a.prototype.invalidateUniform=function(a){this.uniformByLocation[a.locationNumber]=void 0},a.prototype.attributeCached=function(a){if(this.active){if(this.attributeByLocation[a.locationNumber]===a.id)return!0;this.attributeByLocation[a.locationNumber]=a.id}return!1},a.prototype.interleavedAttributeCached=function(a){if(this.active)for(var b,c=0,d=a.attributes.length;d>c;c++){if(b=a.attributes[c],this.attributeByLocation[b.locationNumber]===b.id)return!0;this.attributeByLocation[b.locationNumber]=b.id}return!1},a.prototype.invalidateAttribute=function(a){this.attributeByLocation[a.locationNumber]=void 0},a.prototype.textureCached=function(a,b){if(this.active){if(this.textureByLocation[a]===b.id)return!0;this.textureByLocation[a]=b.id}return!1},a.prototype.invalidateTexture=function(a){this.textureByLocation[a]=void 0},a.prototype.elementsCached=function(a){if(this.active){if(a.id===this.elementId)return!0;this.elementId=a.id}return!1},a.prototype.invalidateElements=function(){this.elementId=-1},a.prototype.clear=function(){this.highestAttributeNumber=-1,this.uniformByLocation.length=0,this.attributeByLocation.length=0,this.textureByLocation.length=0,this.elementId=-1,this.programId=-1},a}(),c.FBO=function(){"use strict";"use restrict";function a(a){a=void 0!==a?a:{},this.id=c.uniqueId(),this.width=a.width||a.size||window.innerWidth,this.height=a.height||a.size||window.innerHeight,this.wrapS=a.wrapS||a.wrap||d.CLAMP_TO_EDGE,this.wrapT=a.wrapT||a.wrap||d.CLAMP_TO_EDGE,this.magFilter=a.magFilter||a.filter||d.LINEAR,this.minFilter=a.minFilter||a.filter||d.LINEAR,this.internalFormat=a.internalFormat||d.RGBA,this.format=a.format||d.RGBA,this.type=a.type||d.UNSIGNED_BYTE,this.depth=void 0!==a.depth?a.depth:!0,this.stencil=void 0!==a.stencil?a.stencil:!1,this.data=a.data||null,this.isBound=!1,this.textureUnit=-1,this.textureType=a.cube!==!0?d.TEXTURE_2D:d.TEXTURE_CUBE_MAP,this.viewport=a.viewport?{x:void 0!==a.viewport.x?a.viewport.x:0,y:void 0!==a.viewport.y?a.viewport.y:0,width:void 0!==a.viewport.width?a.viewport.width:this.width,height:void 0!==a.viewport.height?a.viewport.height:this.height}:{x:0,y:0,width:this.width,height:this.height},a.clear?(this.clearSettings={r:void 0!==a.clear.red?a.clear.red:0,g:void 0!==a.clear.green?a.clear.green:0,b:void 0!==a.clear.blue?a.clear.blue:0,a:void 0!==a.clear.alpha?a.clear.alpha:1,depth:void 0!==a.clear.depth?a.clear.depth:1,bits:void 0!==a.clear.bits?a.clear.bits:-1},-1===this.clearSettings.bits&&(this.clearSettings.bits=d.COLOR_BUFFER_BIT,this.clearSettings.bits|=this.depth?d.DEPTH_BUFFER_BIT:0,this.clearSettings.bits|=this.stencil?d.STENCIL_BUFFER_BIT:0)):(this.clearSettings={r:0,g:0,b:0,a:1,depth:1,bits:0},this.clearSettings.bits=d.COLOR_BUFFER_BIT,this.clearSettings.bits|=this.depth?d.DEPTH_BUFFER_BIT:0,this.clearSettings.bits|=this.stencil?d.STENCIL_BUFFER_BIT:0),this.createBuffers()}var b={posX:0,negX:1,posY:2,negY:3,posZ:4,negZ:5};return a.prototype.createBuffers=function(){this.texture=d.createTexture();var a=d.getError();if(a!==d.NO_ERROR&&a!==d.CONTEXT_LOST_WEBGL)return c.error("GLOW.FBO.createBuffers: Error creating render texture."),void 0;if(d.bindTexture(this.textureType,this.texture),d.texParameteri(this.textureType,d.TEXTURE_WRAP_S,this.wrapS),d.texParameteri(this.textureType,d.TEXTURE_WRAP_T,this.wrapT),d.texParameteri(this.textureType,d.TEXTURE_MAG_FILTER,this.magFilter),d.texParameteri(this.textureType,d.TEXTURE_MIN_FILTER,this.minFilter),this.textureType===d.TEXTURE_2D)null===this.data||this.data instanceof Uint8Array||this.data instanceof Float32Array?d.texImage2D(this.textureType,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.data):d.texImage2D(this.textureType,0,this.internalFormat,this.format,this.type,this.data);else for(var e in b)d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+b[e],0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.data[e]);if(this.depth||this.stencil){if(this.renderBuffer=d.createRenderbuffer(),a=d.getError(),a!==d.NO_ERROR&&a!==d.CONTEXT_LOST_WEBGL)return c.error("GLOW.FBO.createBuffers: Error creating render buffer."),void 0;d.bindRenderbuffer(d.RENDERBUFFER,this.renderBuffer),this.depth&&!this.stencil?d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_COMPONENT16,this.width,this.height):!this.depth&&this.stencil?d.renderbufferStorage(d.RENDERBUFFER,d.STENCIL_INDEX8,this.width,this.height):this.depth&&this.stencil&&d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_STENCIL,this.width,this.height)}if(this.textureType===d.TEXTURE_2D){if(this.frameBuffer=d.createFramebuffer(),a=d.getError(),a!==d.NO_ERROR&&a!==d.CONTEXT_LOST_WEBGL)return c.error("GLOW.FBO.createBuffers: Error creating frame buffer."),void 0;d.bindFramebuffer(d.FRAMEBUFFER,this.frameBuffer),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,this.texture,0),this.depth&&!this.stencil?d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,this.renderBuffer):!this.depth&&this.stencil?d.framebufferRenderbuffer(d.FRAMEBUFFER,d.STENCIL_ATTACHMENT,d.RENDERBUFFER,this.renderBuffer):this.depth&&this.stencil&&d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,this.renderBuffer)}else{this.frameBuffers={};for(var f in b){if(this.frameBuffers[f]=d.createFramebuffer(),a=d.getError(),a!==d.NO_ERROR&&a!==d.CONTEXT_LOST_WEBGL)return c.error("GLOW.FBO.createBuffers: Error creating frame buffer for side "+f),void 0;d.bindFramebuffer(d.FRAMEBUFFER,this.frameBuffers[f]),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_CUBE_MAP_POSITIVE_X+b[f],this.texture,0),this.depth&&!this.stencil?d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,this.renderBuffer):!this.depth&&this.stencil?d.framebufferRenderbuffer(d.FRAMEBUFFER,d.STENCIL_ATTACHMENT,d.RENDERBUFFER,this.renderBuffer):this.depth&&this.stencil&&d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,this.renderBuffer)}}d.bindTexture(this.textureType,null),d.bindRenderbuffer(d.RENDERBUFFER,null),d.bindFramebuffer(d.FRAMEBUFFER,null)},a.prototype.deleteBuffers=function(){if(this.texture&&d.deleteTexture(this.texture),this.renderBuffer&&d.deleteRenderbuffer(this.renderBuffer),this.textureType===d.TEXTURE_2D)this.frameBuffer&&d.deleteFramebuffer(this.frameBuffer);else for(var a in b)d.deleteFramebuffer(this.frameBuffers[a])},a.prototype.init=function(){},a.prototype.bind=function(a,b){return this.isBound||(this.isBound=!0,(a||void 0===a)&&this.setupViewport(a),this.textureType===d.TEXTURE_2D?d.bindFramebuffer(d.FRAMEBUFFER,this.frameBuffer):(b=void 0!==b?b:"posX",d.bindFramebuffer(d.FRAMEBUFFER,this.frameBuffers[b]))),this},a.prototype.unbind=function(a){return this.isBound&&(this.isBound=!1,d.bindFramebuffer(d.FRAMEBUFFER,null),(void 0===a||a===!0)&&d.viewport(c.currentContext.viewport.x,c.currentContext.viewport.y,c.currentContext.viewport.width,c.currentContext.viewport.height)),this},a.prototype.setViewport=function(){this.setupViewport()},a.prototype.setupViewport=function(a){return a&&(this.viewport.x=void 0!==a.x?a.x:this.viewport.x,this.viewport.y=void 0!==a.y?a.y:this.viewport.y,this.viewport.width=void 0!==a.width?a.width:this.viewport.width,this.viewport.height=void 0!==a.height?a.height:this.viewport.height),d.viewport(this.viewport.x,this.viewport.y,this.viewport.width,this.viewport.height),this},a.prototype.setupClear=function(a){return void 0!==a&&(this.clearSettings.r=void 0!==a.red?Math.min(1,Math.max(0,a.red)):this.clearSettings.r,this.clearSettings.g=void 0!==a.green?Math.min(1,Math.max(0,a.green)):this.clearSettings.g,this.clearSettings.b=void 0!==a.blue?Math.min(1,Math.max(0,a.blue)):this.clearSettings.b,this.clearSettings.a=void 0!==a.alpha?Math.min(1,Math.max(0,a.alpha)):this.clearSettings.a,this.clearSettings.depth=void 0!==a.depth?Math.min(1,Math.max(0,a.depth)):this.clearSettings.depth,this.clearSettings.bits=void 0!==a.bits?a.bits:this.clearSettings.bits),d.clearColor(this.clearSettings.r,this.clearSettings.g,this.clearSettings.b,this.clearSettings.a),d.clearDepth(this.clearSettings.depth),this},a.prototype.clear=function(a){return this.isBound&&(this.setupClear(a),d.clear(this.clearSettings.bits)),this},a.prototype.resize=function(a,b){var c=a/this.width,d=b/this.height;return this.viewport.width=this.viewport.width*c,this.viewport.height=this.viewport.height*d,this.width=a,this.height=b,this.deleteBuffers(),this.createBuffers(),this},a.prototype.generateMipMaps=function(){return d.bindTexture(this.textureType,this.texture),d.generateMipmap(this.textureType),d.bindTexture(this.textureType,null),this},a.prototype.dispose=function(){this.deleteBuffers(),delete this.data,delete this.viewport,delete this.texture,delete this.renderBuffer,delete this.frameBuffer,delete this.frameBuffers,delete this.viewport,delete this.clearSettings},a}(),c.Texture=function(){"use strict";"use restrict";function a(a){void 0!==a.url&&(a.data=a.url),this.id=c.uniqueId(),this.data=a.data,this.autoUpdate=a.autoUpdate,this.internalFormat=a.internalFormat||d.RGBA,this.format=a.format||d.RGBA,this.type=a.type||d.UNSIGNED_BYTE,this.wrapS=a.wrapS||a.wrap||d.REPEAT,this.wrapT=a.wrapT||a.wrap||d.REPEAT,this.magFilter=a.magFilter||a.filter||d.LINEAR,this.minFilter=a.minFilter||a.filter||d.LINEAR_MIPMAP_LINEAR,this.width=a.width,this.height=a.height,this.onLoadComplete=a.onLoadComplete,this.onLoadError=a.onLoadError,this.onLoadContext=a.onLoadContext,this.texture=void 0,this.flipY=a.flipY||0}var b={posX:0,negX:1,posY:2,negY:3,posZ:4,negZ:5};return a.prototype.init=function(){if(void 0!==this.texture)return this;if(d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,this.flipY),void 0===this.data&&void 0!==this.width&&void 0!==this.height)this.data=this.type===d.UNSIGNED_BYTE?new Uint8Array(this.width*this.height*(this.format===d.RGBA?4:3)):new Float32Array(this.width*this.height*(this.format===d.RGBA?4:3));else if("string"==typeof this.data){this.textureType=d.TEXTURE_2D;var a=this.data,e=a.toLowerCase();-1!==e.indexOf(".jpg")||-1!==e.indexOf(".png")||-1!==e.indexOf(".gif")||-1!==e.indexOf("jpeg")?(this.data=new Image,this.data.scope=this,this.data.onerror=this.onLoadError,this.data.onload=this.onLoadImage,this.data.src=a):(void 0===this.autoUpdate&&(this.autoUpdate=!0),this.data=document.createElement("video"),this.data.scope=this,this.data.addEventListener("loadeddata",this.onLoadVideo,!1),this.data.src=a)}else if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement||this.data instanceof HTMLCanvasElement||this.data instanceof Uint8Array||this.data instanceof Float32Array)this.textureType=d.TEXTURE_2D,this.createTexture();else{this.textureType=d.TEXTURE_CUBE_MAP,this.itemsToLoad=0;for(var f in b)void 0!==this.data[f]?"string"==typeof this.data[f]&&this.itemsToLoad++:c.error("GLOW.Texture.init: data type error. Did you forget cube map "+f+"? If not, the data type is not supported");if(0===this.itemsToLoad)this.createTexture();else for(var f in b)if("string"==typeof this.data[f]){var a=this.data[f],e=a.toLowerCase();-1!==e.indexOf(".jpg")||-1!==e.indexOf(".png")||-1!==e.indexOf(".gif")||-1!==e.indexOf("jpeg")?(this.data[f]=new Image,this.data[f].scope=this,this.data[f].onload=this.onLoadCubeImage,this.data[f].src=a):(void 0!==this.autoUpdate?this.autoUpdate[f]=void 0!==this.autoUpdate[f]?this.autoUpdate[f]:!0:(this.autoUpdate={},this.autoUpdate[f]=!0),this.data[f]=document.createElement("video"),this.data[f].scope=this,this.data[f].addEventListener("loadeddata",this.onLoadCubeVideo,!1),this.data[f].src=a)}}return this},a.prototype.createTexture=function(){if(void 0!==this.texture&&d.deleteTexture(this.texture),this.texture=d.createTexture(),d.bindTexture(this.textureType,this.texture),this.textureType===d.TEXTURE_2D)if(this.data instanceof Uint8Array||this.data instanceof Float32Array){if(void 0===this.width||void 0===this.height)return c.error("GLOW.Texture.createTexture: Textures of type Uint8Array/Float32Array requires width and height parameters. Quitting."),void 0;d.texImage2D(this.textureType,0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.data)}else d.texImage2D(this.textureType,0,this.internalFormat,this.format,this.type,this.data);else for(var a in b)if(this.data[a]instanceof Uint8Array||this.data[a]instanceof Float32Array){if(void 0===this.width||void 0===this.height)return c.error("GLOW.Texture.createTexture: Textures of type Uint8Array/Float32Array requires width and height parameters. Quitting."),void 0;d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+b[a],0,this.internalFormat,this.width,this.height,0,this.format,this.type,this.data[a])}else d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+b[a],0,this.internalFormat,this.format,this.type,this.data[a]);return d.texParameteri(this.textureType,d.TEXTURE_WRAP_S,this.wrapS),d.texParameteri(this.textureType,d.TEXTURE_WRAP_T,this.wrapT),d.texParameteri(this.textureType,d.TEXTURE_MIN_FILTER,this.minFilter),d.texParameteri(this.textureType,d.TEXTURE_MAG_FILTER,this.magFilter),this.minFilter!==d.NEAREST&&this.minFilter!==d.LINEAR&&d.generateMipmap(this.textureType),this},a.prototype.updateTexture=function(a){if(void 0!==this.texture){a=void 0!==a?a:{};var c=a.level||0,e=a.xOffset||0,f=a.yOffset||0,g=void 0!==a.updateMipmap?a.updateMipmap:!0;if(this.data=a.data||this.data,d.bindTexture(this.textureType,this.texture),this.textureType==d.TEXTURE_2D)this.data instanceof Uint8Array?d.texSubImage2D(this.textureType,c,e,f,this.width,this.height,this.format,this.type,this.data):d.texSubImage2D(this.textureType,c,e,f,this.format,this.type,this.data);else for(var h in a)void 0!==b[h]&&(this.data[h]instanceof Uint8Array?d.texSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+b[h],c,e,f,this.width,this.height,this.format,this.type,this.data[h]):d.texSubImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+b[h],c,e,f,this.format,this.type,this.data[h]));
this.minFilter!==d.NEAREST&&this.minFilter!==d.LINEAR&&g===!0&&d.generateMipmap(this.textureType)}},a.prototype.swapTexture=function(a){this.dispose(),this.data=a,this.init()},a.prototype.onLoadImage=function(){this.scope.createTexture(),this.scope.onLoadComplete&&this.scope.onLoadComplete.call(this.scope.onLoadContext,this.scope)},a.prototype.onLoadError=function(){this.scope.onLoadError&&this.scope.onLoadError.call(this.scope.onLoadContext,this.scope)},a.prototype.onLoadCubeImage=function(){this.scope.itemsToLoad--,0===this.scope.itemsToLoad&&this.scope.createTexture()},a.prototype.onLoadVideo=function(){this.removeEventListener("loadeddata",this.scope.onLoadVideo,!1),this.scope.createTexture()},a.prototype.onLoadCubeVideo=function(){this.removeEventListener("loadeddata",this.scope.onLoadVideo,!1),this.scope.itemsToLoad--,0===this.scope.itemsToLoad&&this.scope.createTexture()},a.prototype.play=function(){if(this.textureType===d.TEXTURE_2D)this.data instanceof HTMLVideoElement&&this.data.play();else for(var a in b)this.data[a]instanceof HTMLVideoElement&&this.data[a].play()},a.prototype.dispose=function(){void 0!==this.texture&&(d.deleteTexture(this.texture),this.texture=void 0),this.data=void 0},a}(),c.Shader=function(){"use strict";"use restrict";function a(a){this.id=c.uniqueId(),this.compiledData=a.use?a.use.clone(a.except):c.Compiler.compile(a),this.uniforms=this.compiledData.uniforms,this.elements=this.compiledData.elements,this.program=this.compiledData.program,this.attachData()}return a.prototype.attachData=function(){var a,b,d;for(a in this.uniforms)void 0===this[a]?void 0!==this.uniforms[a].data?this[a]=this.uniforms[a].data:c.warn("GLOW.Shader.attachUniformAndAttributeData: no data for uniform "+a+", not attaching for easy access. Please use Shader.uniforms."+a+".data to set data."):this[a]!==this.uniforms[a].data&&c.warn("GLOW.Shader.attachUniformAndAttributeData: name collision on uniform "+a+", not attaching for easy access. Please use Shader.uniforms."+a+".data to access data.");for(b in this.compiledData.attributes)void 0===this.attributes&&(this.attributes=this.compiledData.attributes),void 0===this[b]?this[b]=this.compiledData.attributes[b]:this[b]!==this.compiledData.attributes[b]&&c.warn("GLOW.Shader.attachUniformAndAttributeData: name collision on attribute "+b+", not attaching for easy access. Please use Shader.attributes."+b+".data to access data.");for(d in this.compiledData.interleavedAttributes)void 0===this.interleavedAttributes&&(this.interleavedAttributes=this.compiledData.interleavedAttributes),void 0===this[d]?this[d]=this.compiledData.interleavedAttributes[d]:this[d]!==this.compiledData.interleavedAttributes[d]&&c.warn("GLOW.Shader.attachUniformAndAttributeData: name collision on interleavedAttribute "+b+", not attaching for easy access. Please use Shader.interleavedAttributes."+b+".data to access data.")},a.prototype.draw=function(){var a,b,e,f,g,h,i,j=this.compiledData,k=c.currentContext.cache,l=k.attributeByLocation,m=k.uniformByLocation,n=j.attributeArray,o=j.interleavedAttributeArray,p=j.uniformArray;if(!k.programCached(j.program)){d.useProgram(j.program);var q=k.setProgramHighestAttributeNumber(j.program);if(q){var r=j.program.highestAttributeNumber,s=r-q+1;if(q>0)for(;r>=s;s++)d.enableVertexAttribArray(s);else for(s--;s>r;s--)d.disableVertexAttribArray(s)}}if(k.active){for(g=n.length;g--;)b=n[g],b.interleaved===!1&&l[b.locationNumber]!==b.id&&(l[b.locationNumber]=b.id,b.bind());for(g=o.length;g--;){for(a=o[g],e=a.attributes,h=e.length,i=!1;h--;){if(b=e[h],l[b.locationNumber]===b.id){i=!0;break}l[b.locationNumber]=b.id}i||a.bind()}for(g=p.length;g--;)f=p[g],m[f.locationNumber]!==f.id&&(m[f.locationNumber]=f.id,f.load())}else{for(g=n.length;g--;)n[g].interleaved===!1&&n[g].bind();for(g=o.length;g--;)o[g].bind();for(g=p.length;g--;)p[g].load()}j.elements.draw()},a.prototype.clone=function(a){return new c.Shader({use:this.compiledData,except:a})},a.prototype.applyUniformData=function(a,b){if(void 0!==this.compiledData.uniforms[a]){this[a]=b,this.compiledData.uniforms[a].data=b;for(var c=this.compiledData.uniformArray.length;c--;)if(this.compiledData.uniformArray[c].name===a){this.compiledData.uniformArray[c].data=b;break}}},a.prototype.dispose=function(a,b,c){var d,e,f;for(d in this.compiledData.uniforms)delete this[d];for(e in this.compiledData.attributes)delete this[e];for(f in this.compiledData.interleavedAttributes)delete this[f];delete this.program,delete this.elements,delete this.uniforms,delete this.attributes,delete this.interleavedAttributes,this.compiledData.dispose(a,b,c),delete this.compiledData},a}(),c.Elements=function(){"use strict";"use restrict";function a(a,b,e,f){this.id=c.uniqueId(),this.type=void 0!==b?b:d.TRIANGLES,this.offset=void 0!==f?f:0,"number"==typeof a||void 0===a?this.length=a:(a instanceof Uint16Array||(a=new Uint16Array(a)),this.length=a.length,this.elements=d.createBuffer(),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this.elements),d.bufferData(d.ELEMENT_ARRAY_BUFFER,a,e?e:d.STATIC_DRAW))}return a.prototype.draw=function(){void 0!==this.elements?(c.currentContext.cache.elementsCached(this)||d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this.elements),d.drawElements(this.type,this.length,d.UNSIGNED_SHORT,this.offset)):d.drawArrays(this.type,this.offset,this.length)},a.prototype.clone=function(a){return a=a||{},new c.Elements(a.data||this.data,a.type||this.type,a.usage,a.offset||this.offset)},a.prototype.dispose=function(){void 0!==this.elements&&(d.deleteBuffer(this.elements),delete this.elements)},a}(),c.Uniform=function(){"use strict";"use restrict";function a(){f[d.INT]=function(){d.uniform1iv(this.location,this.getNativeValue())},f[d.FLOAT]=function(){d.uniform1fv(this.location,this.getNativeValue())},f[d.INT_VEC2]=function(){d.uniform2iv(this.location,this.getNativeValue())},f[d.INT_VEC3]=function(){d.uniform3iv(this.location,this.getNativeValue())},f[d.INT_VEC4]=function(){d.uniform4iv(this.location,this.getNativeValue())},f[d.BOOL]=function(){d.uniform1iv(this.location,this.getNativeValue())},f[d.BOOL_VEC2]=function(){d.uniform2iv(this.location,this.getNativeValue())},f[d.BOOL_VEC3]=function(){d.uniform3iv(this.location,this.getNativeValue())},f[d.BOOL_VEC4]=function(){d.uniform4iv(this.location,this.getNativeValue())},f[d.FLOAT_VEC2]=function(){d.uniform2fv(this.location,this.getNativeValue())},f[d.FLOAT_VEC3]=function(){d.uniform3fv(this.location,this.getNativeValue())},f[d.FLOAT_VEC4]=function(){d.uniform4fv(this.location,this.getNativeValue())},f[d.FLOAT_MAT2]=function(){d.uniformMatrix2fv(this.location,!1,this.getNativeValue())},f[d.FLOAT_MAT3]=function(){d.uniformMatrix3fv(this.location,!1,this.getNativeValue())},f[d.FLOAT_MAT4]=function(){d.uniformMatrix4fv(this.location,!1,this.getNativeValue())},f[d.SAMPLER_2D]=function(){void 0===this.data.texture||-1===this.textureUnit||c.currentContext.cache.textureCached(this.textureUnit,this.data)||(d.uniform1i(this.location,this.textureUnit),d.activeTexture(d.TEXTURE0+this.textureUnit),d.bindTexture(d.TEXTURE_2D,this.data.texture),this.data.autoUpdate&&this.data.updateTexture(this.data.autoUpdate))},f[d.SAMPLER_CUBE]=function(){void 0===this.data.texture||-1===this.textureUnit||c.currentContext.cache.textureCached(this.textureUnit,this.data)||(d.uniform1i(this.location,this.textureUnit),d.activeTexture(d.TEXTURE0+this.textureUnit),d.bindTexture(d.TEXTURE_CUBE_MAP,this.data.texture),this.data.autoUpdate&&this.data.updateTexture(this.data.autoUpdate))}}function b(b,d){e||(e=!0,a()),this.id=c.uniqueId(),this.data=d,this.name=b.name,this.length=b.length,this.type=b.type,this.location=b.location,this.locationNumber=b.locationNumber,this.textureUnit=void 0!==b.textureUnit?b.textureUnit:-1,this.load=b.loadFunction||f[this.type]}var e=!1,f=[];return b.prototype.getNativeValue=function(){return this.data.value},b.prototype.clone=function(a){return new c.Uniform(this,a||this.data)},b.prototype.dispose=function(a){void 0!==this.data&&this.type===d.SAMPLER_2D&&a&&this.data.dispose(),delete this.data,delete this.load,delete this.location},b}(),c.Attribute=function(){"use strict";"use restrict";function a(){f[d.INT]=1,f[d.INT_VEC2]=2,f[d.INT_VEC3]=3,f[d.INT_VEC4]=4,f[d.BOOL]=1,f[d.BOOL_VEC2]=2,f[d.BOOL_VEC3]=3,f[d.BOOL_VEC4]=4,f[d.FLOAT]=1,f[d.FLOAT_VEC2]=2,f[d.FLOAT_VEC3]=3,f[d.FLOAT_VEC4]=4,f[d.FLOAT_MAT2]=4,f[d.FLOAT_MAT3]=9,f[d.FLOAT_MAT4]=16}function b(b,g,h,i){e||(e=!0,a()),this.id=c.uniqueId(),this.data=g,this.location=b.location,this.locationNumber=b.locationNumber,this.stride=0,this.offset=0,this.usage=void 0!==h?h:d.STATIC_DRAW,this.interleaved=void 0!==i?i:!1,this.size=f[b.type],this.name=b.name,this.type=b.type,this.data&&(this.data.length/this.size>65536&&c.warn("GLOW.Attribute.constructor: Unreachable attribute? Please activate GL.drawArrays or split into multiple shaders. Indexed elements cannot reach attribute data beyond 65535."),this.interleaved===!1&&this.bufferData(this.data,this.usage))}var e=!1,f=[];return b.prototype.setupInterleave=function(a,b){this.interleaved=!0,this.offset=a,this.stride=b},b.prototype.bufferData=function(a,b){void 0!==a&&this.data!==a&&(this.data=a),void 0!==b&&this.usage!==b&&(this.usage=b),void 0===this.buffer&&(this.buffer=d.createBuffer()),-1!==this.data.constructor.toString().indexOf(" Array()")&&(this.data=new Float32Array(this.data)),d.bindBuffer(d.ARRAY_BUFFER,this.buffer),d.bufferData(d.ARRAY_BUFFER,this.data,this.usage)},b.prototype.bind=function(){this.interleaved===!1&&d.bindBuffer(d.ARRAY_BUFFER,this.buffer),d.vertexAttribPointer(this.location,this.size,d.FLOAT,!1,this.stride,this.offset)},b.prototype.clone=function(a){return this.interleaved?(c.error("GLOW.Attribute.clone: Cannot clone interleaved attribute. Please check your interleave setup."),void 0):(a=a||{},new c.Attribute(this,a.data||this.data,a.usage||this.usage,a.interleaved||this.interleaved))},b.prototype.dispose=function(){this.buffer&&(d.deleteBuffer(this.buffer),delete this.buffer),delete this.data},b}(),c.InterleavedAttributes=function(){"use strict";"use restrict";function a(a){this.id=c.uniqueId(),this.attributes=a;var b,e,f,g,h,i,j=a[0].data.length/a[0].size,k=a.length,l=[],m=[];for(e=0;k>e;e++)l[e]=0;for(b=0;j>b;b++)for(e=0;k>e;e++){for(i=a[e].data,h=l[e],f=0,g=a[e].size;g>f;f++)m.push(i[h++]);l[e]=h}for(this.data=new Float32Array(m),this.usage=a[0].usage,e=0;k>e;e++)if(this.usage!==a[e].usage){c.warn("GLOW.InterleavedAttributes.construct: Attribute "+a[e].name+" has different usage, defaulting to STATIC_DRAW."),this.usage=d.STATIC_DRAW;break}this.bufferData(this.data,this.usage);var n=0;for(e=0;k>e;e++)n+=4*a[e].size;var o=0;for(e=0;k>e;e++)a[e].setupInterleave(o,n),o+=4*a[e].size}return a.prototype.bufferData=function(a,b){void 0!==a&&this.data!==a&&(this.data=a),void 0===this.buffer&&(this.buffer=d.createBuffer()),d.bindBuffer(d.ARRAY_BUFFER,this.buffer),d.bufferData(d.ARRAY_BUFFER,this.data,b?b:d.STATIC_DRAW)},a.prototype.bind=function(){d.bindBuffer(d.ARRAY_BUFFER,this.buffer);for(var a=this.attributes.length;a--;)this.attributes[a].bind()},a.prototype.dispose=function(){if(this.buffer&&(d.deleteBuffer(this.buffer),delete this.buffer),delete this.data,this.attributes){for(var a=this.attributes.length;a--;)this.attributes[a].dispose();delete this.attributes}},a}(),b.exports=c},{}],3:[function(a){var b=(a("./utils/function").bindAll,a("./utils/object").extend),c=a("./utils/Looper"),d=a("./sketch/VideoBuffer"),e=a("./sketch/VideoSketch"),f=!0,g=16,h=new d(4*g,3*g),i=new e(h,{nodesMax:200,nodesRemove:10}),j=new c(function(){i.draw()});i.setSize(window.innerWidth,window.innerHeight),i.setRange(200,400);var k=document.body,l=document.getElementById("start");k.appendChild(i.el),b(i.el.style,{position:"absolute",top:"0",left:"0"});var m=function(a){a||(k.className+="is-recording")};f&&(k.appendChild(h.el),b(h.el.style,{position:"absolute",top:"10px",left:"10px",webkitTransform:"scaleX(-1)"}),document.addEventListener("keyup",function(a){switch(a.which){case 82:h.request(m);break;case 32:h.toggle(),j.toggle()}})),l.addEventListener("click",function(){h.request(m)}),window.addEventListener("resize",function(){i.setSize(window.innerWidth,window.innerHeight)}),h.play(),j.play()},{"./sketch/VideoBuffer":5,"./sketch/VideoSketch":6,"./utils/Looper":7,"./utils/function":9,"./utils/object":10}],4:[function(a,b){b.exports={distanceSq:function(a,b,c,d){var e=c-a,f=d-b;return e*e+f*f}}},{}],5:[function(a,b){function c(a,b){this.el=document.createElement("video"),this.buffer=document.createElement("canvas"),this.ctx=this.buffer.getContext("2d"),this.setSize(a,b),this.pixels=d("f32",4*this.size),this.el.addEventListener("ended",this.onVideoEnd.bind(this))}var d=a("../utils/array").create;b.exports=c,c.prototype={request:function(a){var b=this;navigator.webkitGetUserMedia({video:!0},function(c){b.hasDiff=!1,b.isStreaming=!0,b.stream=c,b.setSource(window.URL.createObjectURL(c)),b.play(),a(null)},function(b){console.error(b),a(b)})},setSize:function(a,b){var c=this.el,d=this.buffer;this.width=c.width=d.width=a,this.height=c.height=d.height=b,this.size=a*b},setSource:function(a,b){if(!b)return this.el.src=a,void 0;for(var c,d=this.formats,e=0,f=b.length;f>e;e++)if(c=b[e],d[c]){this.el.src=a+"."+c;break}},formats:function(){var a=document.createElement("video");if(!a||!a.canPlayType)return null;var b=a.canPlayType.bind(a);return{mp4:!!b('video/mp4; codecs="mp4v.20.8"'),h264:!(!b('video/mp4; codecs="avc1.42E01E"')&&!b('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')),ogv:!!b('video/ogg; codecs="theora"'),webm:!!b('video/webm; codecs="vp8, vorbis"')}}(),seek:function(a){this.el.currentTime=a},play:function(){this.isPlaying=!0,this.el.play()},pause:function(){this.isPlaying=!1,this.el.pause()},toggle:function(){this.isPlaying?this.pause():this.play()},onVideoEnd:function(){this.seek(0),this.play()},readPixels:function(){var a=this.ctx,b=this.width,c=this.height;return a.drawImage(this.el,0,0,b,c),a.getImageData(0,0,b,c)},forFrameDiff:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=this.hasDiff,q=this.pixels,r=(this.points,0),s=b[0],t=b[1];for(d=0,e=a.length;e>d;d+=4)g=a[d],i=a[d+1],h=a[d+2],j=q[d],l=q[d+1],k=q[d+2],m=Math.abs(g-j),o=Math.abs(i-l),n=Math.abs(h-k),a[d]=m,a[d+1]=o,a[d+2]=n,q[d]=g,q[d+1]=i,q[d+2]=h,r+=f=m+o+n,p&&f>s&&t>f&&c(d/4,f);r>0&&(this.hasDiff=!0)}}},{"../utils/array":8}],6:[function(a,b){function c(a,b){d(this,"addNode"),e.extend(this,b),this._nodePoolIndex=0,this._nodePool=[],this.nodes=[],this.quadtree=null,this.range=f.create("f32",2),this.context=new j.Context({clear:{red:.2,green:.2,blue:.2,alpha:1}}),this.gl=this.context.GL,this.el=this.context.domElement,this.video=a,this.context.enableBlend(!0,{equation:this.gl.FUNC_ADD,src:this.gl.SRC_ALPHA,dst:this.gl.ONE}),this.initShader(5e3)}var d=(a("fs"),a("../utils/function").bindAll),e=a("../utils/object"),f=a("../utils/array"),g=a("../math/vec2"),h=a("../../libs/d3/d3-quadtree"),i=h().x(function(a){return a[0]}).y(function(a){return a[1]}),j=a("../../libs/glow/GLOWCore"),k=!1;b.exports=c,c.prototype={polyShaderConfig:{vertexShader:"attribute float opacity;\nattribute vec2 vertices;\n\nvarying float vOpacity;\n\nvoid main() {\n	vOpacity = opacity;\n	gl_Position = vec4(vertices.x, vertices.y, 1.0, 1.0);\n}\n",fragmentShader:"#ifdef GL_ES\n	precision highp float;\n#endif\n\nuniform	float screenWidth;\nuniform	float screenHeight;\n\nvarying float vOpacity;\n\nfloat c = 1.0;\n\nvoid main() {\n	float x = gl_FragCoord.x / screenWidth;\n	float y = gl_FragCoord.y / screenHeight;\n\n	gl_FragColor = vec4(x, 0.4, y, vOpacity * 0.05);\n}\n"},initShader:function(a){var b=e.extend({data:{screenWidth:{value:f.create("f32",1)},screenHeight:{value:f.create("f32",1)},opacity:f.create("f32",3*a),vertices:f.create("f32",3*a*2)},indices:f.range("ui8",3*a),primitives:this.gl.TRIANGLES,interleave:{opacity:!1,vertices:!1},usage:{opacity:this.gl.DYNAMIC_DRAW,vertices:this.gl.DYNAMIC_DRAW,primitives:this.gl.DYNAMIC_DRAW}},this.polyShaderConfig);this.polys=new j.Shader(b),console.log(b,this.polys)},setSize:function(a,b){var c=this.el,d=this.polys;this.width=c.width=d.screenWidth.value[0]=a,this.height=c.height=d.screenHeight.value[0]=b,this.size=a*b},setRange:function(a,b){var c=this.range;c[0]=a,c[1]=b},getNodeFromPool:function(){var a=this._nodePool,b=this._nodePoolIndex,c=a[this._nodePoolIndex];return c||(c=a[b]=f.create("f32",3)),this._nodePoolIndex++,c},shiftNodePool:function(a){var b=this._nodePool,c=b.splice(0,a);this._nodePool=b.concat(c),this._nodePoolIndex-=a,k&&console.log(this._nodePool.length)},addNode:function(a,b){var c=this.getNodeFromPool(),d=this.video.width,e=this.video.height;c[0]=Math.abs(a%d/d-1),c[1]=Math.abs(Math.floor(a/d)/e-1),c[2]=b,this.nodes.push(c)},updateQuadtree:function(){this.quadtree=i(this.nodes)},draw:function(){var a=this.video;if(a.isStreaming||a.isPlaying){var b=this.nodes,c=this.context,d=this.polys,e=a.readPixels();a.forFrameDiff(e.data,this.range,this.addNode),b.length&&(this.updateQuadtree(),k&&console.log(b.length,this._nodePool.length));var f,g,h=d.attributes.vertices,i=d.attributes.opacity,j=i.data;for(f=0,g=b.length;g>f;f++)this.updateNode(h,i,b[f],f);for(f=0,g=j.length;g>f;f++)j[f]=Math.max(0,j[f]-.01);h.bufferData(),i.bufferData(),c.cache.clear(),c.clear(),d.draw(),b.length&&this.reset()}},updateNode:function(){function a(a,b){return Math.atan2(b[1]-a[1],b[0]-a[0])}function b(b){return function(c,d){return a(b,c)-a(b,d)}}function c(a,b,c){var d=a._index;(!d||2*d+1>a.length)&&(d=a._index=0),a[2*d]=2*c[0]-1,a[2*d+1]=2*c[1]-1,b[d]=1,a._index++}return function(a,d,e){var f,g,h,i,j=a.data,k=d.data,l=e[2]/3e3,m=this.search(this.quadtree,e[0],e[1],l);for(m.sort(b(e)),f=1,g=m.length;g>f;f++)h=m[f-1],i=m[f],c(j,k,e),c(j,k,h),c(j,k,i)}}(),search:function(a,b,c,d){var e=b-d,f=c-d,h=b+d,i=c+d,j=d*d,k=[];return a.visit(function(a,d,l,m,n){var o=a.point;return o&&g.distanceSq(b,c,o[0],o[1])<=j&&k.push(o),d>=h||l>=i||e>m||f>n}),k},reset:function(){var a=this.nodes,b=Math.max(a.length-this.nodesMax,this.nodesRemove);a.splice(0,b),this.shiftNodePool(b)}}},{"../../libs/d3/d3-quadtree":1,"../../libs/glow/GLOWCore":2,"../math/vec2":4,"../utils/array":8,"../utils/function":9,"../utils/object":10,fs:11}],7:[function(a,b){function c(a){function b(){c&&(a(),window.requestAnimationFrame(b))}var c=!1;this.pause=function(){c=!1},this.play=function(){c=!0,b()},this.toggle=function(){c=!c,c&&b()}}b.exports=c},{}],8:[function(a,b){var c=this,d={i8:"Int8Array",ui8:"Uint8Array",ui8c:"Uint8ClampedArray",i16:"Int16Array",ui16:"Uint16Array",i32:"Int32Array",ui32:"Uint32Array",f32:"Float32Array",f64:"Float64Array"};b.exports={create:function(a,b){var e=c[d[a]||a]||Array;return new e(b)},range:function(a,b){for(var c=this.create(a,b),d=0;b>d;d++)c[d]=d;return c}}},{}],9:[function(a,b){var c=Array.prototype.slice;b.exports={bindAll:function(){for(var a,b=arguments[0],d=c.call(arguments,1),e=0,f=d.length;f>e;e++)a=d[e],b[a]=b[a].bind(b)}}},{}],10:[function(a,b){b.exports={extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}}},{}],11:[function(){},{}]},{},[3]);